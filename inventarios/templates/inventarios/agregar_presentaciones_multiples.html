<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Presentaciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Agregar Presentaciones para {{ producto.nombre }}</h1>

        <!-- Formulario de presentaciones -->
        <form id="presentacionForm" method="post" action="{% url 'inventarios:agregar_presentaciones_multiples' producto.id %}">
            {% csrf_token %}
            <!-- Campos del formulario de presentaciones -->
            <div class="mb-3">
                <label for="nombre_presentacion" class="form-label">Nombre de la Presentación</label>
                {{ form.nombre_presentacion }}
            </div>
            <div class="mb-3">
                <label for="cantidad" class="form-label">Cantidad por Presentación</label>
                {{ form.cantidad }}
            </div>
            <div class="mb-3">
                <label for="precio" class="form-label">Precio</label>
                {{ form.precio }}
            </div>
            <!-- Selección múltiple de sucursales -->
            <div class="mb-3">
                <label for="sucursales" class="form-label">Sucursales</label>
                {{ form.sucursales }}
            </div>

            <button type="submit" class="btn btn-primary">Guardar Presentación</button>
        </form>

        <div id="mensajeExito" class="alert alert-success mt-3" style="display: none;">
            La presentación se guardó exitosamente.
        </div>

        <button id="btnNuevaPresentacion" class="btn btn-info mt-4">Agregar otra Presentación</button>

        <a href="{% url 'inventarios:lista_productos' %}" class="btn btn-secondary mt-4">Volver al Inventario</a>
    </div>

    <!-- Bootstrap JS (opcional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript para manejar el envío por AJAX -->
    <script>
        document.getElementById('presentacionForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevenir que se recargue la página
            
            const form = this;
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('mensajeExito').style.display = 'block';
                    form.reset(); // Limpiar el formulario para una nueva presentación
                } else {
                    alert('Error al guardar la presentación.');
                    console.log('Errores:', data.errors);  // Mostrar los errores exactos en la consola
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un problema al enviar la presentación.');
            });
        });

    </script>
    
</body>
</html>
